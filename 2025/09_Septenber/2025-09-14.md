# 2025년 09월 14일 TIL 
## Fact: BERT 모델 Fine-tuning

### 알게 된 것 (What I learned)
- Tokenizer 작동방식 이해
- Pytorch 클래스 구조

### NSMCDataset 클래스
```python
from torch.utils.data import Dataset

class NSMCDataset(Dataset):
    def __init__(self, dataframe, tokenizer, max_len):
        self.tokenizer = tokenizer
        self.data = dataframe
        self.max_len = max_len
        
    def __len__(self):
        return len(self.data)
        
    def __getitem__(self, index):
        # 1. 행(row)에서 리뷰 텍스트와 라벨을 가져옵니다.
        review = str(self.data.iloc[index]['document'])
        label = self.data.iloc[index]['label']
        
        # 2. 텍스트를 토큰화합니다.
        inputs = self.tokenizer.encode_plus(
            review,
            None,
            add_special_tokens=True,
            max_length=self.max_len,
            padding='max_length',
            truncation=True,
            return_tensors='pt'
        )
        
        # 3. 필요한 정보들을 딕셔너리 형태로 반환합니다.
        return {
            'input_ids': inputs['input_ids'].flatten(),
            'attention_mask': inputs['attention_mask'].flatten(),
            'labels': torch.tensor(label, dtype=torch.long)
        }
```

### 참고 자료 (Reference)
- 이 프로젝트의 일부 아이디어 구체화 및 코드 디버깅 과정에서 Google의 Gemini를 활용하였다.

- **Tool:** Google Gemini
- **Date of Use:** 2025년 9월
- **Usage:**
    - 모델 훈련 코드 작성
    - 코드 스니펫 오류 수정 및 최적화

## Trouble Shooting: API베포 방화벽 문제

### 겪은 문제 (Problem)
- 학습된 모델을 api로 배포하려고 했는데 만든 서버에 접속이 불가했다.

### 원인 분석 (Cause)
1. 서버가 실행되고 있지 않았다.
2. WSL환경이라 Windows로 접속이 불가했다.
3. 방화벽이 접속을 차단하고 있다.

### 해결 방법 (Solution)
- `curl` 테스트를 해봤지만 정상적이라 서버는 문제 없었다.
- 서버를 시작할 때 외부에서도 접속할 수 있도록 --host 0.0.0.0 옵션을 추가해보았지만
  ```bash
  uvicorn main:app --reload --host 0.0.0.0
  ```
  접속이 불가했다.
- 접속을 원격 컴퓨터의 방화벽이 차단한 것으로 판단되므로 원격 컴퓨터에 접속해서 방화벽 인바운드 규칙을 추가해봐야 한다.

### 배운 점 (Takeaway)
- 모델의 파라미터는 데이터에 맞춰 수정해야 모델의 성능이 올라간다.
- 포트는 사용 목적에 따라 나눠서 사용해야 한다. (중복 불가)
